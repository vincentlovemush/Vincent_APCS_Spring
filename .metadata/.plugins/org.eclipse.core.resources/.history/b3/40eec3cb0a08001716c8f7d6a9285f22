package textExcel;

// Update this file with your own code.

public class Spreadsheet implements Grid
{	private Cell[][] excel= new Cell[this.getRows()][this.getCols()];
public Spreadsheet(){
	for (int i=0;i<excel.length;i++){
		for (int j=0;j<excel[i].length;j++)
			excel[i][j]=new EmptyCell();
	}
}
@Override
public String processCommand(String command)
{	
	if(command.equals(""))
		return command;
	//clear
	if (command.toUpperCase().equals("CLEAR")){
		for (int i=0;i<excel.length;i++){
			for (int j=0;j<excel[i].length;j++)
				excel[i][j]=new EmptyCell();
		}
		return this.getGridText();
	}
	//clear a cell
	if (command.toUpperCase().startsWith("CLEAR")){
		excel[Integer.parseInt(command.substring(7))-1][command.toUpperCase().charAt(6)-65] = new EmptyCell();
		return this.getGridText();
	}
	command=command.substring(0,1).toUpperCase()+command.substring(1);
	if (command.charAt(0)>64&&command.charAt(0)<91){
		//inspection
		if(command.indexOf('=')==-1){
			String cellValue=excel[Integer.parseInt(command.substring(1))-1][command.charAt(0)-65].fullCellText();
			return cellValue;
		}	
		//assignment of TextCell
		if (command.indexOf('=')!=-1 && command.indexOf('"')!=-1){
			if(command.charAt(2)==' ')
				excel[Integer.parseInt(command.substring(1,2))-1][command.charAt(0)-65]=new TextCell(command.substring(command.indexOf('"')+1,command.lastIndexOf('"')));
			else
				excel[Integer.parseInt(command.substring(1,3))-1][command.charAt(0)-65]=new TextCell(command.substring(command.indexOf('"')+1,command.lastIndexOf('"')));
			String newSpreadsheet = this.getGridText();
			return newSpreadsheet;
		}
		//assignment of FormulaCell
		else if(command.indexOf('=')!=-1 && command.indexOf("(")!=-1&&command.indexOf(")")!=-1){
			if(command.charAt(2)==' ')
				excel[Integer.parseInt(command.substring(1,2))-1][command.charAt(0)-65]=new FormulaCell(command.substring(command.indexOf('(')+1,command.lastIndexOf(')')));
			else
				excel[Integer.parseInt(command.substring(1,3))-1][command.charAt(0)-65]=new FormulaCell(command.substring(command.indexOf('(')+1,command.lastIndexOf(')')));
		}
	}

	return command;
}

@Override
public int getRows()
{
	return 20;
}

@Override
public int getCols()
{
	return 12;
}

@Override
public Cell getCell(Location loc)
{
	return excel[loc.getRow()][loc.getCol()];
}

@Override
public String getGridText()
{
	String grid="   |A         |B         |C         |D         |E         |F         |G         |H         |I         |J         |K         |L         |"+"\n";
	for (int i=0;i<this.getRows();i++){
		if(i<9)
			grid=grid+(i+1)+"  ";
		else
			grid=grid+(i+1)+" ";
		for (int j=0;j<this.getCols();j++){
			grid=grid+"|"+ excel[i][j].abbreviatedCellText();
		}
		grid=grid+"|\n";
	}

	return grid;
}

}
